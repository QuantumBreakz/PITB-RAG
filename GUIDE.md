# Extensive Guide: PITB RAG Model v0.2 - CrossEncoder Enhanced

This guide will help you set up, use, and extend the Streamlit RAG app that leverages CrossEncoder for document re-ranking and supports multiple PDF uploads.

---

## Table of Contents
1. [Environment Setup](#environment-setup)
2. [Dependency Management](#dependency-management)
3. [Running the App](#running-the-app)
4. [Using the App](#using-the-app)
5. [Customizing the App](#customizing-the-app)
6. [Extending File Support](#extending-file-support)
7. [Troubleshooting](#troubleshooting)
8. [Advanced Tips](#advanced-tips)

---

## 1. Environment Setup

- **Recommended:** Use a virtual environment to avoid dependency conflicts.
- **Python Version:** 3.9 or higher.

### Steps:
```bash
python3 -m venv venv
source venv/bin/activate
```

---

## 2. Dependency Management

- All required packages are listed in `requirements.txt`.
- Install them with:
```bash
pip install -r requirements.txt
```

If you add new packages, update `requirements.txt` using:
```bash
pip freeze > requirements.txt
```

---

## 3. Running the App

Start the Streamlit app with:
```bash
streamlit run app.py
```

The app will open in your browser (usually at http://localhost:8501).

---

## 4. Using the App

- **Upload PDFs:** Use the sidebar to upload one or more PDF files.
- **Enter Query:** Type your question in the sidebar.
- **Process:** Click "Process and Re-Rank" to analyze and rank document chunks.
- **Results:** The top relevant chunks will be displayed in the main area.

---

## 5. Customizing the App

- **Change CrossEncoder Model:**
  - Edit the model name in `app.py` (look for `CrossEncoder("cross-encoder/ms-marco-MiniLM-L-6-v2")`).
  - You can use any compatible model from [Hugging Face](https://huggingface.co/models?library=sentence-transformers&pipeline_tag=text-classification).

- **Adjust Chunk Size/Overlap:**
  - Modify `chunk_size` and `chunk_overlap` in the `RecursiveCharacterTextSplitter` in `app.py`.

- **Change Top-K Results:**
  - Adjust the `top_k` parameter in the `re_rank_cross_encoders` function.

---

## 6. Extending File Support

- **Add DOCX Support:**
  - Install `python-docx` or `unstructured`.
  - In `process_documents`, add logic to handle `.docx` files using a suitable loader.

- **Other Formats:**
  - Use appropriate loaders from `langchain_community.document_loaders` or implement your own.

---

## 7. Troubleshooting

- **Import Errors:**
  - Ensure your IDE uses the correct Python interpreter (the one in `venv`).
  - Restart your IDE after installing packages.

- **Streamlit Not Found:**
  - Make sure you installed all dependencies in the active environment.

- **CrossEncoder Model Download Issues:**
  - Check your internet connection.
  - If behind a proxy, set the appropriate environment variables.

- **Out of Memory:**
  - For large PDFs or many files, reduce chunk size or process fewer files at a time.

---

## 8. Advanced Tips

- **GPU Acceleration:**
  - If you have a CUDA-capable GPU, install the appropriate `torch` version for better performance.

- **Database Integration:**
  - Use `sqlite-utils` to inspect or manage any SQLite files generated by your workflow.

- **Production Deployment:**
  - Consider deploying with Streamlit Cloud, Docker, or a cloud VM for broader access.

---

## Need Help?
- Open an issue on your repository or consult the documentation for the relevant libraries. 